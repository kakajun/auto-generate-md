ä¸‹é¢æ˜¯æ•´ä¸ªå·¥ç¨‹çš„ç›®å½•æ–‡ä»¶ç»“æ„
â”œâ”€â”€ api
â”‚ â”œâ”€â”€ aa.js            
â”‚ â””â”€â”€ user.js            //2å·¥ç¨‹
â”œâ”€â”€ base
â”‚ â””â”€â”€ temp
â”‚ â”‚ â”œâ”€â”€ aa.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”‚ â””â”€â”€ app-file-test.vue            
â”œâ”€â”€ script
â”‚ â”œâ”€â”€ cli
â”‚ â”‚ â”œâ”€â”€ handle.ts            
â”‚ â”‚ â””â”€â”€ index.ts            
â”‚ â””â”€â”€ help
â”‚ â”‚ â””â”€â”€ index.ts            
â”œâ”€â”€ src
â”‚ â”œâ”€â”€ commands
â”‚ â”‚ â”œâ”€â”€ agmd.ts            
â”‚ â”‚ â”œâ”€â”€ change-path.ts            
â”‚ â”‚ â”œâ”€â”€ command-actions.ts            /* ç•Œé¢å‘½ä»¤æ³¨å†Œåœ¨è¿™é‡Œ */
â”‚ â”‚ â”œâ”€â”€ command-handler.ts            // å‘½ä»¤å¤„ç†é€»è¾‘
â”‚ â”‚ â”œâ”€â”€ get-file.ts            /* è·å–æ–‡ä»¶ç›¸å…³æ–¹æ³• */
â”‚ â”‚ â”œâ”€â”€ get-router.ts            
â”‚ â”‚ â”œâ”€â”€ mark-file.ts            /* ç»™è·¯ç”±æ–‡ä»¶æ‰“æ ‡è®°, æŠŠæ ‡è®°æ‰“åˆ°æœ€å,å› ä¸ºå¤´éƒ¨å·²ç»ç»™äº†æ³¨é‡Š */
â”‚ â”‚ â”œâ”€â”€ mark-write-file.ts            
â”‚ â”‚ â”œâ”€â”€ rename-path.ts            /* ç»™è·¯ç”±æ–‡ä»¶æ‰“æ ‡è®°, æŠŠæ ‡è®°æ‰“åˆ°æœ€å,å› ä¸ºå¤´éƒ¨å·²ç»ç»™äº†æ³¨é‡Š */
â”‚ â”‚ â””â”€â”€ wirte-md.ts            /* ç”Ÿæˆmdè¯´æ˜æ–‡æ¡£ */
â”‚ â”œâ”€â”€ shared
â”‚ â”‚ â””â”€â”€ constant.ts            /* è§£æpackage */
â”‚ â”œâ”€â”€ utils
â”‚ â”‚ â””â”€â”€ router-utils.ts            
â”‚ â”œâ”€â”€ bin.ts            
â”‚ â”œâ”€â”€ index.ts            /* è¿™é‡ŒæŠ›å‡ºä¸€äº›é«˜çº§æ“ä½œæ–¹æ³• */
â”‚ â””â”€â”€ types.ts            // å®šä¹‰ Router æ¥å£
â”œâ”€â”€ temp
â”‚ â”œâ”€â”€ check-test-kable-case2
â”‚ â”‚ â””â”€â”€ testTemplate.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ my
â”‚ â”‚ â”œâ”€â”€ aa.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”‚ â””â”€â”€ wite-file2.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ myVue
â”‚ â”‚ â””â”€â”€ myTable
â”‚ â”‚ â”‚ â””â”€â”€ test-template.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ test-kable-case
â”‚ â”‚ â”œâ”€â”€ test-kable-case2
â”‚ â”‚ â””â”€â”€ youTemplate.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ aa.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ app-file-test.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ app2-file-test.vue            //mark
â”‚ â”œâ”€â”€ bb.vue            
â”‚ â”œâ”€â”€ delet-mark-all.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”œâ”€â”€ mark-setmark.vue            //setmark
â”‚ â””â”€â”€ wite-file-test.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”œâ”€â”€ test
â”‚ â”œâ”€â”€ config
â”‚ â”‚ â”œâ”€â”€ jest-global-setup.ts            
â”‚ â”‚ â””â”€â”€ jest.setup.ts            
â”‚ â”œâ”€â”€ utils
â”‚ â”‚ â”œâ”€â”€ deep-nodes-test.ts            
â”‚ â”‚ â”œâ”€â”€ function-test.ts            
â”‚ â”‚ â”œâ”€â”€ nodes-test.ts            
â”‚ â”‚ â””â”€â”€ utils.ts            /* æµ‹è¯•å…¬å…±æ–¹æ³• */
â”‚ â”œâ”€â”€ __mocks__
â”‚ â”‚ â””â”€â”€ fs.ts            
â”‚ â”œâ”€â”€ change-path.test.ts            
â”‚ â”œâ”€â”€ get-file.test.ts            
â”‚ â”œâ”€â”€ get-router.test.ts            
â”‚ â”œâ”€â”€ mark-file.test.ts            
â”‚ â”œâ”€â”€ mark-write-file.test.ts            // import { createConsola } from 'consola'
â”‚ â”œâ”€â”€ rename-path.test.ts            
â”‚ â”œâ”€â”€ rename.test.ts            
â”‚ â”œâ”€â”€ renamecopy.ts            
â”‚ â””â”€â”€ wirte-md.test.ts            
â”œâ”€â”€ test2
â”‚ â””â”€â”€ temp
â”‚ â”‚ â”œâ”€â”€ my
â”‚ â”‚ â”‚ â”œâ”€â”€ aa.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”‚ â”‚ â””â”€â”€ wite-file2.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”‚ â”‚ â””â”€â”€ wite-file-test.vue            // æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
â”œâ”€â”€ unuse
â”‚ â”œâ”€â”€ assets
â”‚ â”œâ”€â”€ components
â”‚ â”‚ â”œâ”€â”€ test
â”‚ â”‚ â”‚ â””â”€â”€ deep
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ user.vue            //2å·¥ç¨‹
â”‚ â”‚ â”œâ”€â”€ test2
â”‚ â”‚ â”‚ â””â”€â”€ HelloWorld.vue            //2å·¥ç¨‹
â”‚ â”‚ â””â”€â”€ user-rulerts.vue            
â”‚ â”œâ”€â”€ test
â”‚ â”‚ â”œâ”€â”€ index.js            /* æˆ‘å°±æ˜¯ä¸ªæµ‹è¯• */
â”‚ â”‚ â””â”€â”€ user-rulerts.vue            
â”‚ â”œâ”€â”€ App.vue            
â”‚ â”œâ”€â”€ main.js            //2å·¥ç¨‹
â”‚ â””â”€â”€ mixins.js            
â”œâ”€â”€ classify.js            
â””â”€â”€ jest.config.ts            

ğŸ˜ ä»£ç æ€»æ•°ç»Ÿè®¡ï¼š
åç¼€æ˜¯ .js çš„æ–‡ä»¶æœ‰ 6 ä¸ª
åç¼€æ˜¯ .vue çš„æ–‡ä»¶æœ‰ 22 ä¸ª
åç¼€æ˜¯ .ts çš„æ–‡ä»¶æœ‰ 35 ä¸ª
æ€»å…±æœ‰ 63 ä¸ªæ–‡ä»¶
æ€»ä»£ç è¡Œæ•°æœ‰: 3,406è¡Œ,
æ€»ä»£ç å­—æ•°æœ‰: 88,680ä¸ª
path:/api/aa.js
export default function name(params) {

}
//2å·¥ç¨‹

path:/script/cli/handle.ts
import help from '../help'
import pkg from '../../package.json'
interface parseType {
  version?: Boolean | undefined
  includes?: string[]
  ignores?: string[]
  help?: Boolean | undefined
  ignore?: string | undefined
  include?: string | undefined
}
function handle(settings: parseType) {
  if (settings.help) {
    help()
  }
  if (settings.version) {
    console.log(`agmd version is: ` + '\x1B[36m%s\x1B[0m', pkg.version)
    process.exit(0)
  }
  if (settings.ignore) {
    settings.ignores = settings.ignore.split(' ')
  }
  if (settings.include) {
    settings.includes = settings.include.split(' ')
  }
  return settings
}

export default handle

path:/src/shared/constant.ts
/* è§£æpackage */
import { name, version } from '../../package.json';

export const CWD = process.cwd();

export const VERSION = version;

export const PKG_NAME = name;

path:/script/help/index.ts
const st = `ä½¿ç”¨è¯´æ˜:
1. åœ¨æ§åˆ¶å°æŒ‰ä¸Šä¸‹åˆ‡æ¢åŠŸèƒ½å¹¶å›è½¦è¿›è¡Œç¡®è®¤, æ‰§è¡Œç›¸å¯¹åº”çš„æ“ä½œï¼
2. å¯ä»¥åœ¨package.jsonä¸­çš„scriptsä¸‹é¢é…ç½®å¦‚ä¸‹ï¼Œç„¶åè¿è¡Œå‘½ä»¤:
agmd  --include str  --ignore str
  é€‰é¡¹:
  --include string  / -i string..........  åŒ…æ‹¬æ–‡ä»¶æ‰©å±•å
  --ignore string  / -in string........... å¿½ç•¥æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹

  å„é€‰é¡¹çš„é»˜è®¤é…ç½®:
  --ignore  img,styles,node_modules,LICENSE,.git,.github,dist,.husky,.vscode,readme-file.js,readme-md.js
  --include  .js,.vue,.ts,.tsx

  è¯´æ˜:
  é…ç½®ä¸­çš„å­—ç¬¦ä¸²ä¹‹é—´ä¸åº”æœ‰ç©ºæ ¼

  ä¸¾ä¾‹:

  $ agmd  --ignore lib,node_modules,dist --include .js,.ts,.vue`

function help() {
  console.log(st)
  process.exit(0)
}
export default help

path:/base/temp/aa.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/src/utils/router-utils.ts

import { access, readFile } from 'fs/promises';
/**
 * è§£æè·¯ç”±æ–‡ä»¶ä¸­çš„è·¯ç”±è·¯å¾„ã€‚
 * @param {string} line - è·¯ç”±æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚
 * @return {string} - è§£æå‡ºçš„è·¯ç”±è·¯å¾„ã€‚
 */
export function parseRouterPath(line: string): string {
  const pathRegex = /path:\s*['"]([^'"]+)['"]/
  const match = line.match(pathRegex)
  return match ? match[1] : ''
}

/**
 * è§£æè·¯ç”±æ–‡ä»¶ä¸­çš„ç»„ä»¶è·¯å¾„ã€‚
 * @param {string} line - è·¯ç”±æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚
 * @return {string | ''} - è§£æå‡ºçš„ç»„ä»¶è·¯å¾„æˆ–nullã€‚
 */
export function parseComponentPath(line: string): string {
  const componentRegex = /component:\s*\(\)\s*=>\s*import\(['"]([^'"]+)['"]\)/
  const match = line.match(componentRegex)
  return match ? match[1] : ''
}

export async function getDependencies(packageJsonPath: string): Promise<string[]> {
  let dependencies: string[] = [];
  if (packageJsonPath) {
    try {
      await access(packageJsonPath);
      const pkg = JSON.parse(await readFile(packageJsonPath, 'utf-8'));
      dependencies = Object.keys(pkg.dependencies || {}).concat(Object.keys(pkg.devDependencies || {}));
    } catch (error) {
      console.error(error);
    }
  }
  return dependencies;
}

path:/src/commands/agmd.ts
#!/usr/bin/env node
/* æä¸ªæ–‡ä»¶åšbugæµ‹è¯•,å‘½ä»¤è¡Œä¸å¥½è°ƒè¯• */
import { generateAllAction } from './command-actions'
import { getMd } from './wirte-md'
import stringToArgs from '../../script/cli'
import handle from '../../script/cli/handle'

 async function main() {
  const options = stringToArgs(process.argv)
  const { ignores: ignore, includes: include } = handle(options)
  const { md, nodes } =await getMd({ ignore, include })
  await generateAllAction(nodes, md)
}

main()

path:/temp/check-test-kable-case2/testTemplate.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/src/bin.ts
#!/usr/bin/env node
import { Command } from 'commander'
import { handleCommand } from './commands/command-handler'
const program = new Command()
program.action(handleCommand)
program.parse(process.argv)

path:/temp/my/aa.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
</script>
path:/temp/myVue/myTable/test-template.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/temp/test-kable-case/youTemplate.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/test/utils/deep-nodes-test.ts
const rootPath = process.cwd().replace(/\\/g, '/')
const nodeComponents = [
  {
    name: 'test',
    isDir: true,
    level: 0,
    note: '',
    imports: [],
    belongTo: [],
    children: [
      {
        name: 'deep',
        isDir: true,
        level: 1,
        note: '',
        imports: [],
        belongTo: [],
        children: [
          {
            name: 'user.vue',
            isDir: false,
            level: 2,
            note: '//2å·¥ç¨‹',
            imports: [rootPath + '/api/user.js'],
            belongTo: [],
            size: 1791,
            rowSize: 109,
            suffix: '.vue',
            fullPath: rootPath + '/unuse/components/test/deep/user.vue'
          }
        ],
        fullPath: rootPath + '/unuse/components/test/deep'
      }
    ],
    fullPath: rootPath + '/unuse/components/test'
  },
  {
    name: 'test2',
    isDir: true,
    level: 0,
    note: '',
    imports: [],
    belongTo: [],
    children: [
      {
        name: 'HelloWorld.vue',
        isDir: false,
        level: 1,
        note: '//2å·¥ç¨‹',
        imports: [rootPath + '/unuse/components/test/deep/user.vue'],
        belongTo: [],
        size: 411,
        rowSize: 31,
        suffix: '.vue',
        fullPath: rootPath + '/unuse/components/test2/HelloWorld.vue'
      }
    ],
    fullPath: rootPath + '/unuse/components/test2'
  },
  {
    name: 'user-rulerts.vue',
    isDir: false,
    level: 0,
    note: '',
    imports: [rootPath + '/unuse/components/test/deep/user.vue'],
    belongTo: [],
    size: 2503,
    rowSize: 105,
    suffix: '.vue',
    fullPath: rootPath + '/unuse/components/user-rulerts.vue'
  }
]

export default nodeComponents

path:/test/config/jest-global-setup.ts
import fs from 'fs-extra'
import { createConsola } from 'consola'
const rootPath = process.cwd().replace(/\\/g, '/')
const logger = createConsola({
  level: 4
})

module.exports = async () => {
  logger.start('æ¸…ç©ºæµ‹è¯•æ–‡ä»¶å¤¹')
  // ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›å…¨å±€åˆå§‹åŒ–ä»£ç 
  const foldPath = rootPath + '/temp'
  const foldPath2 = rootPath + '/test2'
  function deleteFolderRecursive(p: string) {
    if (fs.existsSync(p)) {
      fs.readdirSync(p).forEach((file) => {
        const curPath = `${p}/${file}`
        if (fs.lstatSync(curPath).isDirectory()) {
          deleteFolderRecursive(curPath)
        } else {
          fs.unlinkSync(curPath)
        }
      })
      fs.rmdirSync(p)
    }
  }

  deleteFolderRecursive(foldPath)
  deleteFolderRecursive(foldPath2)
}

path:/temp/aa.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/test/change-path.test.ts
import path from 'path'
import { readFile, writeFile } from 'fs/promises'
import { getRelatPath, makeSuffix, changeImport, writeToFile, getImportName } from '../src/commands/change-path'
import { nodeOne } from './utils/nodes-test'
import { createConsola } from 'consola'
const logger = createConsola({
  level: 4
})
const rootPath = process.cwd().replace(/\\/g, '/')
describe('change-pathçš„æµ‹è¯•', () => {
  test('getRelatPath--è·å–ç›¸å¯¹åœ°å€', () => {
    expect(getRelatPath('/unuse/components/user-rulerts.vue', '/unuse/App.vue')).toEqual(
      './components/user-rulerts.vue'
    )
  })

  test('makeSuffix--è¡¥å…¨åç¼€å’Œ@æ›¿æ¢', () => {
    expect(makeSuffix('@/src/commands/change-path', '@/src/commands/change-path')).toEqual(
      path.resolve('src/commands/change-path.ts').replace(/\\/g, '/')
    )
  })
  test('makeSuffix--å¾—åˆ°import', () => {
    const arrs = getImportName(
      `import
      { getRelatPath,
         makeSuffix,
         changeImport
      } from '@/unuse/components/user-rulerts'`,
      ['@types/node']
    )
    logger.info('arrs: ', arrs)
    expect(arrs).toEqual('@/unuse/components/user-rulerts')
  })

  test('changeImport--æ›´æ”¹ä¸è§„èŒƒpath', () => {
    expect(
      changeImport(
        "import { getRelatPath, makeSuffix, changeImport } from '@/unuse/components/user-rulerts'",
        path.resolve('unuse/App.vue').replace(/\\/g, '/'),
        ['@types/node']
      )
    ).toEqual({
      filePath: '@/unuse/components/user-rulerts',
      impName: './components/user-rulerts.vue',
      absoluteImport: rootPath + '/unuse/components/user-rulerts.vue'
    })
  })

  test('writeToFile--æ›´æ”¹ä¸è§„èŒƒpath', (done) => {
    try {
      const node = nodeOne[0]
      // 1. éšæœºåˆ›å»ºä¸€ä¸ªæ–‡ä»¶
      const str = `<script setup>
import {
  UserRuler,
  aa
} from '@/unuse/components/user-rulerts'
</script>`
      //2. é¢„æœŸå¾—åˆ°å†…å®¹
      const finalStr = `<script setup>
import {
  UserRuler,
  aa
} from '../unuse/components/user-rulerts.vue'
</script>`

      const file = path.resolve(rootPath, node.fullPath)
      logger.info('file: ', file)

      async function get() {
        // å¼‚æ­¥å†™å…¥æ•°æ®åˆ°æ–‡ä»¶
        await writeFile(file, str, { encoding: 'utf8' })
        logger.success('Write successful')
        await writeToFile(node, true)
        const getStr = await readFile(file, 'utf-8')
        expect(getStr).toEqual(finalStr)
        done()
      }
      get()
    } catch (error) {
      done(error)
    }
  })
})

path:/test/__mocks__/fs.ts
import { fs } from 'memfs'

fs.mkdirSync('/tmp')
if (process.env.TMPDIR) {
  fs.mkdirSync(process.env.TMPDIR, { recursive: true })
}

const fsRealpath = fs.realpath
;(fsRealpath as any).native = fsRealpath

module.exports = { ...fs, realpath: fsRealpath }

path:/test2/temp/my/aa.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
</script>
path:/test2/temp/wite-file-test.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
</script>
path:/unuse/components/test/deep/user.vue
//2å·¥ç¨‹
//2å·¥ç¨‹
ue2.0å†™æ³• */
<template>
  <div class="wrapper">
    <SketchRule
      :thick="thick"
      :scale="scale"
      :width="582"
      :height="482"
      :start-x="startX"
      :start-y="startY"
      :shadow="shadow"
      :hor-line-arr="lines.h"
      :ver-line-arr="lines.v"
      :corner-active="true"
      @handleLine="handleLine"
      @onCornerClick="handleCornerClick"
    >
    </SketchRule>
    <div
      id="screens"
      ref="screensRef"
      @wheel="handleWheel"
      @scroll="handleScroll"
    >
      <div ref="containerRef" class="screen-container">
        <div id="canvas" :style="canvasStyle" />
      </div>
    </div>
  </div>
</template>
<script>
import { businessUserInfo, updataUserInfo, addUserInfo } from '../../../../api/user.js'
export default {
  components: { SketchRule },
}
</script>
<style lang="scss">
body {
  padding: 0;
  margin: 0;
  overflow: hidden;
  font-family: sans-serif;
}

body * {
  box-sizing: border-box;
  user-select: none;
}

.wrapper {
  position: absolute;
  top: 100px;
  left: 100px;
  width: 600px;
  height: 500px;
  background-color: #f5f5f5;
  border: 1px solid #dadadc;
}

#screens {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: auto;
}

.screen-container {
  position: absolute;
  width: 5000px;
  height: 3000px;
}

.scale-value {
  position: absolute;
  bottom: 100%;
  left: 0;
}

.button {
  position: absolute;
  bottom: 100%;
  left: 100px;
}

#canvas {
  position: absolute;
  top: 80px;
  left: 50%;
  width: 160px;
  height: 200px;
  margin-left: -80px;
  background: lightblue;
  transform-origin: 50% 0;
}
</style>

//1å·¥ç¨‹
//1å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹
//2å·¥ç¨‹

path:/unuse/test/index.js
/* æˆ‘å°±æ˜¯ä¸ªæµ‹è¯• */
import app from '../app.vue'
console.log('main')

path:/unuse/components/user-rulerts.vue

<script lang="ts">
// import { SketchRule } from 'vue3-sketch-ruler'
// import 'vue3-sketch-ruler/lib/style.css'
// import { SketchRule } from '../../lib/index.es'
// import '/lib/style.css'
import {
  computed,
  defineComponent,
  ref,
  reactive,
  onMounted,
  nextTick,
} from "vue";
import { SketchRule } from "./test/deep/user.vue"; // è¿™é‡Œå¯ä»¥æ¢æˆæ‰“åŒ…åçš„

const rectWidth = 600;
const rectHeight = 320;
export default defineComponent({
  components: { SketchRule },
  setup() {
    const screensRef = ref(null);
    const containerRef = ref(null);
    const state = reactive({
      scale: 2, //658813476562495, //1,
      startX: 0,
      startY: 0,
      lines: {
        h: [433, 588],
        v: [33, 143],
      },
      thick: 20,
      isShowRuler: true, // æ˜¾ç¤ºæ ‡å°º
      isShowReferLine: true, // æ˜¾ç¤ºå‚è€ƒçº¿
    });
    const shadow = computed(() => {
      return {
        x: 0,
        y: 0,
        width: rectWidth,
        height: rectHeight,
      };
    });
    const canvasStyle = computed(() => {
      return {
        width: rectWidth,
        height: rectHeight,
        transform: `scale(${state.scale})`,
      };
    });
    onMounted(() => {
      // æ»šåŠ¨å±…ä¸­
      screensRef.value.scrollLeft =
        containerRef.value.getBoundingClientRect().width / 2 - 400;
    });

    const handleScroll = () => {
      const screensRect = document
        .querySelector("#screens")
        .getBoundingClientRect();
      const canvasRect = document
        .querySelector("#canvas")
        .getBoundingClientRect();

      // æ ‡å°ºå¼€å§‹çš„åˆ»åº¦
      const startX =
        (screensRect.left + state.thick - canvasRect.left) / state.scale;
      const startY =
        (screensRect.top + state.thick - canvasRect.top) / state.scale;
      state.startX = startX;
      state.startY = startY;
    };
    // æ§åˆ¶ç¼©æ”¾å€¼
    const handleWheel = (e: {
      ctrlKey: any;
      metaKey: any;
      preventDefault: () => void;
      deltaY: number;
    }) => {
      if (e.ctrlKey || e.metaKey) {
        e.preventDefault();
        const nextScale = parseFloat(
          Math.max(0.2, state.scale - e.deltaY / 500).toFixed(2)
        );
        state.scale = nextScale;
      }
      nextTick(() => {
        handleScroll();
      });
    };

    return {
      screensRef,
      containerRef,
      state,
      shadow,
      canvasStyle,
      handleWheel,
      handleScroll,
    };
  },
});
</script>
//2å·¥ç¨‹

path:/unuse/App.vue

<script>
import UserRuler from './components/user-rulerts.vue'
</script>

<template>
  <div>
      <UserRuler />
    <a href="https://data.avuejs.com/build/1" target="_blank" class="redlink">
      å®ä¾‹åœ°å€:https://data.avuejs.com/build/1
    </a>
    <div>æŒ‰ä½Ctril+é¼ æ ‡æ»šè½®å¯ä»¥ç¼©æ”¾é¡µé¢</div>
  </div>

</template>

<style>
#app {
  margin-top: 60px;
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  color: #2c3e50;
  text-align: center;
}
</style>
//2å·¥ç¨‹

path:/unuse/components/test2/HelloWorld.vue
//2å·¥ç¨‹


<script>
import user from '../test/deep/user.vue';
export default {
  name: 'HelloWorld',
  props: {
    msg: String
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
h3 {
  margin: 40px 0 0;
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}
</style>

path:/classify.js
export default [
  {
    name: '2å·¥ç¨‹',
    router: [
      {
        path: '/spc/list',
        component: '@/unuse/App.vue'
      },
      {
        path: '/spc/list',
        component: '@/unuse/main.js'
      },
    ]
  }
]

path:/script/cli/index.ts
import arg from 'arg'
const stringToArgs = (rawArgs: string[]) => {
  const args = arg(
    {
      '--ignore': String,
      '--include': String,
      '--version': Boolean,
      '--help': Boolean,
      '-h': '--help',
      '-i': '--ignore',
      '-in': '--include',
      '-v': '--version'
    },
    {
      argv: rawArgs.slice(2)
    }
  )
  return {
    help: args['--help'],
    ignore: args['--ignore'],
    include: args['--include'],
    version: args['--version']
  }
}

export default stringToArgs

path:/api/user.js
//2å·¥ç¨‹
export default function name(params) {}
//2å·¥ç¨‹

path:/base/temp/app-file-test.vue
<script setup>
import {
  UserRuler,
  aa
} from '../unuse/components/user-rulerts.vue'
</script>
path:/src/commands/change-path.ts
import fs from 'fs'
import path from 'path'
import { readFile, writeFile } from 'fs/promises'
import { createConsola } from 'consola'
import { getDependencies } from '../utils/router-utils'
import type { ItemType } from '../types'
const logger = createConsola({
  level: 4
})

const rootPath = process.cwd().replace(/\\/g, '/')

/**
 * æ£€æŸ¥å½“å‰ç›®å½•æ˜¯å¦ä¸ºé¡¹ç›®æ ¹ç›®å½•ã€‚
 * æ ¹æ®æ˜¯å¦å­˜åœ¨ package.json æ–‡ä»¶æ¥åˆ¤æ–­ã€‚
 */
function isRootDirectory(): boolean {
  const packageJsonPath = path.join(process.cwd(), 'package.json')
  try {
    fs.accessSync(packageJsonPath, fs.constants.R_OK)
    return true
  } catch (error) {
    return false
  }
}

/**
 * @desc: é€’å½’å¾ªç¯æ‰€æœ‰æ–‡ä»¶

 * @param {Array} nodes      æ•´ä¸ªæ–‡ä»¶çš„nodes
 */
export async function changePath(nodes: ItemType[], nochangePath?: Boolean) {
  async function getNode(objs: ItemType[]) {
    for (const ele of objs) {
      if (ele.children) {
        await getNode(ele.children)
      } else {
        if (isRootDirectory()) {
          await writeToFile(ele, true, nochangePath)
        }
      }
    }
  }
  await getNode(nodes)
}

/**
 * @desc: è¿™é‡Œè¿”å›æ²¡æœ‰@ ç¬¦å·çš„è·¯å¾„
 * @param {string} absoluteImport  ä¾èµ–æœ¬èº«åå­—
 * @param {string} fullPath  æ–‡ä»¶æœ¬èº«ç»å¯¹åœ°å€
 */
export function getRelatPath(absoluteImport: string, fullPath: string) {
  let relatPath = path.relative(path.dirname(fullPath), absoluteImport).replace(/\\/g, '/')
  if (!relatPath.startsWith('.')) {
    relatPath = './' + relatPath
  }
  return relatPath
}

/**
 * @desc: è¡¥åç¼€çš„æ–¹æ³•+æ›¿æ¢å‰ç¼€
 * @param {string} filePath  æ­£åˆ™åŒ¹é…åˆ°çš„ä¾èµ–è·¯å¾„
 * @param {string} fullPath  æœ¬èº«æ–‡ä»¶åè·¯å¾„
 * @param {string} impName   æ­£ç¡®çš„åå­—
 */
export function makeSuffix(filePath: string, fullPath: string) {
  let absoluteImport = filePath.includes('@')
    ? filePath.replace('@', process.cwd())
    : path.resolve(path.dirname(fullPath), filePath)

  const lastName = path.extname(absoluteImport)

  if (!lastName) {
    const suffixes = ['.ts', '.vue', '.tsx', '.js', '/index.js', '/index.vue']
    for (const suffix of suffixes) {
      if (fs.existsSync(absoluteImport + suffix)) {
        absoluteImport += suffix
        // logger.info('è¡¥å……åç¼€:', absoluteImport + suffix)
        break
      }
    }
  }
  return absoluteImport.replace(/\\/g, '/')
}

/**
 * @desc: æ ¹æ®ä¸€è¡Œä»£ç åŒ¹é…importçš„è¯¦ç»†å†…å®¹  TODO è¿™é‡Œè¿˜å¾—ä¼˜åŒ–

 */
export function getImportName(ele: string, dependencies: string[]) {
  let str = ''
  const flag = dependencies.some((item) => ele.indexOf(item) > -1)
  const reg = / from [\"|\'](.*)[\'|\"]/
  // è¿™é‡Œåªæ”¶é›†ç»„ä»¶ä¾èµ–, æ’ä»¶ä¾èµ–æ’é™¤æ‰
  if (!flag && ele.indexOf('/') > -1 && ele.indexOf('//') !== 0) {
    const impStr = ele.match(reg)
    // æ²¡æœ‰importçš„ä¸è½¬
    if (impStr && impStr[1]) str = impStr[1]
  }
  return str
}

/**
 * @desc: æ‰¾åˆ°importå¹¶è¿”å›å…¨è·¯å¾„å’ŒåŸå§‹è·¯å¾„
 * @param {string} ele    æ‰¾åˆ°çš„è¡Œå¼•å…¥
 * @param {string} fullPath  æ–‡ä»¶çš„å…¨è·¯å¾„
 */
export function changeImport(ele: string, fullPath: string, dependencies: string[], nochangePath?: Boolean) {
  const impName = getImportName(ele, dependencies)
  if (!impName) return null

  const absoluteImport = makeSuffix(impName, fullPath)
  const obj = {
    impName: nochangePath ? impName : getRelatPath(absoluteImport, fullPath),
    filePath: impName,
    absoluteImport
  }
  return obj
}

/**
 * @desc:  å†™æ–‡ä»¶
 * @param {string} file  ç›®æ ‡åœ°å€
 */
export async function writeToFile(node: ItemType, isRelative?: Boolean, nochangePath?: Boolean) {
  const { fullPath } = node
  const packageJsonPath = path.join(rootPath, 'package.json')
  const dependencies = await getDependencies(packageJsonPath)

  try {
    const fileStr = await readFile(fullPath, 'utf-8')
    const lines = fileStr.split(/[\n]/g)

    // ä½¿ç”¨ map() æ¥å¤„ç†æ¯ä¸€è¡Œ
    const updatedLines = lines.map((line) => {
      if (line.includes('from') && isRelative) {
        const obj = changeImport(line, fullPath, dependencies, nochangePath)
        if (obj && obj.impName) {
          // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ¥å¢åŠ å¯è¯»æ€§
          logger.info(`Updating import in node: ${node}`)
          return line.replace(obj.filePath, obj.impName)
        }
      }
      return line
    })

    // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å˜åŒ–
    if (updatedLines.join('\n') !== fileStr) {
      await writeFile(fullPath, updatedLines.join('\n'), 'utf-8')
      logger.success(`Write file successful: ${fullPath}`)
    }
  } catch (error) {
    // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
    logger.error(`Error reading file: ${fullPath}, Error: ${error}`)
  }
}
/**
 * @description: Write the result to JS file æŠŠç»“æœå†™å…¥åˆ°jsæ–‡ä»¶
 * @param {data}  è¦å†™çš„æ•°æ®
 * @return {fileName}  è¦å†™å…¥æ–‡ä»¶åœ°å€
 */
export async function wirteJsNodes(data: string, filePath: string): Promise<void> {
  const file = path.resolve(rootPath, filePath)
  const content = `export default ${data}`
  await writeFile(file, content, { encoding: 'utf8' })
  logger.success(`Write file successful: ${filePath}`)
}

path:/src/index.ts
/* è¿™é‡ŒæŠ›å‡ºä¸€äº›é«˜çº§æ“ä½œæ–¹æ³• */
import { getMd } from './commands/wirte-md'
import { getFileNodes } from './commands/get-file'
export { getMd, getFileNodes }

path:/temp/my/wite-file2.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/test/utils/function-test.ts
import { replaceName } from '../../src/commands/rename-path'
import { createConsola } from 'consola'
// const rootPath = process.cwd().replace(/\\/g, '/')
const logger = createConsola({
  level: 4
})

async function get() {
  const p = await replaceName('/path/to/myFile.txt')
  logger.info('p: ', p)
  logger.info('æˆ‘è¿™é‡Œæ¥äº†!!!')
}
get()

path:/test/config/jest.setup.ts
import fs from 'fs-extra'
import { createConsola } from 'consola'
const rootPath = process.cwd().replace(/\\/g, '/')
const foldPath = rootPath + '/temp'
const logger = createConsola({
  level: 4
})

beforeAll(() => {
  logger.info('new unit test start')
  fs.ensureDirSync(foldPath)
  // ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›å…¨å±€åˆå§‹åŒ–ä»£ç 
})

path:/temp/app-file-test.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/test/get-file.test.ts
import { getFile, getImport, getFileNodes, getNote, setMd } from '../src/commands/get-file'
import { creatFile } from './utils/utils'
import type { ItemType } from '../src/types'
import deepNodes from './utils/deep-nodes-test'
import { createConsola } from 'consola'
const rootPath = process.cwd().replace(/\\/g, '/')
const logger = createConsola({
  level: 4
})

// ç”±äºlinuxçš„ç©ºæ ¼æ•°å’Œwindowçš„ç©ºæ ¼æ•°ä¸ä¸€æ ·, æ‰€ä»¥sizeå§‹ç»ˆä¸ä¸€æ ·, æ— æ³•æµ‹è¯•, æ‰€ä»¥è¿™é‡Œå¹²æ‰size
// é€’å½’æ ‘ç»“æ„è®¾ç½®sizeä¸º0
function setSize(temparrs: any[]) {
  temparrs.forEach((item) => {
    item.size = 0
    if (item.children) {
      setSize(item.children)
    }
  })
}

describe('setMd', () => {
  it('should correctly format the string for a directory', () => {
    const obj: ItemType = {
      name: 'dir',
      isDir: true,
      level: 1,
      note: '',
      fullPath: '',
      belongTo: [],
      imports: []
    }

    const result = setMd(obj, false)

    expect(result).toEqual('â”‚ â”œâ”€â”€ dir\n')
  })

  it('should correctly format the string for a file', () => {
    const obj: ItemType = {
      name: 'file.js',
      isDir: false,
      level: 1,
      note: 'note',
      fullPath: '',
      belongTo: [],
      imports: []
    }
    const result = setMd(obj, true)
    expect(result).toEqual('â”‚ â””â”€â”€ file.js            note\n')
  })
})

describe('get-fileçš„æµ‹è¯•', () => {
  test('getFile--è·å–æ³¨é‡Š', (done) => {
    const file = rootPath + '/temp/app-file-test.vue'
    const file2 = rootPath + '/temp/aa.vue'
    try {
      async function get() {
        await creatFile(file)
        await creatFile(file2)
        const obj = await getFile(file)
        expect(obj).toEqual({
          note: '// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š',
          rowSize: 4,
          size: 63,
          imports: [rootPath + '/temp/aa.vue']
        })
        done()
      }
      get()
    } catch (error) {
      done(error)
    }
  })

  test('getImport--è·å–æ¯ä¸ªæ–‡ä»¶ä¾èµ–çš„æ–¹æ³•', (done) => {
    const str = `<script setup>
import UserRuler from '@/unuse/components/user-rulerts'
</script>`
    try {
      async function get() {
        const sarr = str.split(/[\n]/g)
        const arrs = await getImport(sarr, rootPath + '/temp/bb.vue')
        expect(arrs).toMatchObject([rootPath + '/unuse/components/user-rulerts.vue'])
        done()
      }
      get()
    } catch (error) {
      done(error)
    }
  })

  test('getFileNodes--ç”Ÿæˆæ‰€æœ‰æ–‡ä»¶çš„nodeä¿¡æ¯', (done) => {
    try {
      async function get() {
        const arrs = await getFileNodes(rootPath + '/unuse/components')
        setSize(arrs)
        setSize(deepNodes)
        // console.log(JSON.stringify(deepNodes), 'arrs')
        expect(arrs).toMatchObject(deepNodes)

        done()
      }
      get()
    } catch (error) {
      logger.error(error)
      done(error)
    }
  })

  test('getImport--è·å–æ¯ä¸ªæ–‡ä»¶ä¾èµ–çš„æ–¹æ³•', (done) => {
    try {
      async function get() {
        const notes = await getFileNodes(rootPath + '/unuse/components')
        setSize(notes)
        const arrs = getNote(notes)
        const final = [
          'â”œâ”€â”€ test\n',
          'â”‚ â””â”€â”€ deep\n',
          'â”‚ â”‚ â””â”€â”€ user.vue            //2å·¥ç¨‹\n',
          'â”œâ”€â”€ test2\n',
          'â”‚ â””â”€â”€ HelloWorld.vue            //2å·¥ç¨‹\n',
          'â””â”€â”€ user-rulerts.vue            \n'
        ]
        // console.log(JSON.stringify(arrs), 'arrs')
        expect(arrs).toMatchObject(final)
        done()
      }
      get()
    } catch (error) {
      logger.error(error)
      done(error)
    }
  })
})

path:/test2/temp/my/wite-file2.vue
// æˆ‘å°±æ˜¯ä¸ªæ³¨é‡Š
<script setup>
import UserRuler from './aa'
</script>
path:/unuse/test/user-rulerts.vue

<script lang="ts">
// import { SketchRule } from 'vue3-sketch-ruler'
// import 'vue3-sketch-ruler/lib/style.css'
// import { SketchRule } from '../../lib/index.es'
// import '/lib/style.css'
import {
  computed,
  defineComponent,
  ref,
  reactive,
  onMounted,
  nextTick,
} from "vue";
import { SketchRule } from "./test/deep/user.vue"; // è¿™é‡Œå¯ä»¥æ¢æˆæ‰“åŒ…åçš„

const rectWidth = 600;
const rectHeight = 320;
export default defineComponent({
  components: { SketchRule },
  setup() {
    const screensRef = ref(null);
    const containerRef = ref(null);
    const state = reactive({
      scale: 2, //658813476562495, //1,
      startX: 0,
      startY: 0,
      lines: {
        h: [433, 588],
        v: [33, 143],
      },
      thick: 20,
      isShowRuler: true, // æ˜¾ç¤ºæ ‡å°º
      isShowReferLine: true, // æ˜¾ç¤ºå‚è€ƒçº¿
    });
    const shadow = computed(() => {
      return {
        x: 0,
        y: 0,
        width: rectWidth,
        height: rectHeight,
      };
    });
    const canvasStyle = computed(() => {
      return {
        width: rectWidth,
        height: rectHeight,
        transform: `scale(${state.scale})`,
      };
    });
    onMounted(() => {
      // æ»šåŠ¨å±…ä¸­
      screensRef.value.scrollLeft =
        containerRef.value.getBoundingClientRect().width / 2 - 400;
    });

    const handleScroll = () => {
      const screensRect = document
        .querySelector("#screens")
        .getBoundingClientRect();
      const canvasRect = document
        .querySelector("#canvas")
        .getBoundingClientRect();

      // æ ‡å°ºå¼€å§‹çš„åˆ»åº¦
      const startX =
        (screensRect.left + state.thick - canvasRect.left) / state.scale;
      const startY =
        (screensRect.top + state.thick - canvasRect.top) / state.scale;
      state.startX = startX;
      state.startY = startY;
    };
    // æ§åˆ¶ç¼©æ”¾å€¼
    const handleWheel = (e: {
      ctrlKey: any;
      metaKey: any;
      preventDefault: () => void;
      deltaY: number;
    }) => {
      if (e.ctrlKey || e.metaKey) {
        e.preventDefault();
        const nextScale = parseFloat(
          Math.max(0.2, state.scale - e.deltaY / 500).toFixed(2)
        );
        state.scale = nextScale;
      }
      nextTick(() => {
        handleScroll();
      });
    };

    return {
      screensRef,
      containerRef,
      state,
      shadow,
      canvasStyle,
      handleWheel,
      handleScroll,
    };
  },
});
</script>
//2å·¥ç¨‹

path:/unuse/main.js
//2å·¥ç¨‹
import { createApp } from 'vue'
// import '../lib/style.css'
import SketchRule from './components/test2/HelloWorld.vue'
// import moduleName from '../api/aa.js';
const app = createApp(App)
// app.use(SketchRule);
import './mixins.js'
// const MyComponent = app.component('SketchRule')
// console.log(MyComponent, 'MyComponentMyComponent')
app.mount('#app')

path:/jest.config.ts
export default {
  // æŒ‡å®š Jest ç¯å¢ƒ
  testEnvironment: 'node',
  // æŒ‡å®šå¤„ç† TypeScript çš„è½¬æ¢å™¨
  transform: {
    '^.+\\.ts$': 'ts-jest'
    // 'ts-jest': {
    //   useESM: true,
    // },
  },
  // è®¾ç½®æ¨¡å—æ–‡ä»¶çš„æ‰©å±•å
  moduleFileExtensions: ['ts', 'js', 'json', 'node'],

  // è®¾ç½®éœ€è¦å¿½ç•¥çš„æ–‡ä»¶æˆ–ç›®å½•
  testPathIgnorePatterns: ['/node_modules/'],

  // å¦‚æœä½¿ç”¨ ESMï¼Œåˆ™è®¾ç½®æ­¤é€‰é¡¹
  extensionsToTreatAsEsm: ['.ts'],
  globalSetup: './test/config/jest-global-setup.ts', // å…¨å±€
  setupFilesAfterEnv: ['./test/config/jest.setup.ts'],
  clearMocks: true,
  // é…ç½® Jest å¦‚ä½•è§£ææ¨¡å—ï¼Œç‰¹åˆ«æ˜¯å¯¹äº ESM
  moduleNameMapper: {
    '^(\\.{1,2}/.*)\\.js$': '$1'
  }
}

